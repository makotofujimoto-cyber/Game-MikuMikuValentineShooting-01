<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>シューティングゲームサンプル</title>
  <link rel="icon" href="apple-touch-icon-180x180.png" type="image/x-icon">
  <style>
body {
  background-color: #f0f0f0; /* 背景色を設定 */
  margin: 0;
  overflow: hidden;
  display: flex;
  justify-content: center; /* 横方向の中央揃え */
  align-items: center;    /* 縦方向の中央揃え */
  height: 100vh;           /* ビューポートの高さを100%に設定 */
}

#game-container {
  position: relative;
  width: 400px; /* ゲーム画面の幅 */
  height: 650px; /* ゲーム画面の高さ */
  border: 1px solid #ccc;
  background-color: #fff; /* ゲーム画面の背景色 */
}

#gameTitle {
  text-align:center;
  font-size:1.1vw;
  z-index: 1;
}

#player {
  position: absolute;
  width: 20px;
  height: 20px;
  background-color: transparent; /* 背景色を透明に */
  background-size: cover;
  background-image: url('シューティングゲームフォルダ/yumiya.png'); /* プレイヤー画像 */
}
.bullet {
  position: absolute;
  width: 5px; /* 弾の幅 */
  height: 10px; /* 弾の高さ */
  background-color: red; /* 弾の色 */
}
.enemy {
  position: absolute;
  width: 30px; /* 敵の幅 */
  height: 30px; /* 敵の高さ */
  background-color: transparent; /* 背景色を透明に */
  background-size: cover;
  background-image: url('シューティングゲームフォルダ/HeartMark.png'); /* 敵画像 */
}
#score {
  position: absolute;
  top: 2px;
  left: 10px;
  color: #333;
}

#timer {
  position: absolute;
  top: 2px;
  left: 150px; /* スコアの右隣に配置 */
  font-size: 20px;
  color: #333;
}

#timer-input {
  position: absolute;
  bottom: 10px; /* 画面右下に配置 */
  right: 10px;
  width: 80px;
  font-size: 16px;
  text-align: right;
}

#game-over {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  color: red;
  display: none; /* 最初は非表示 */
}
#start-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 10px 20px;
  font-size: 20px;
  background-color: #28a745;
  color: white;
  border: none;
  cursor: pointer;
}
.message {
  position: absolute;
  top: 50%; /* 中央に配置 */
  left: 50%; /* 中央に配置 */
  transform: translate(-50%, -50%);
  display: none;
  font-size: 20px;
  color: #000;
  text-align: center;
}
</style>
</head>
<body>
  <div id="game-container">
  <div id="gameTitle">  
    <h4>Miku Miku Valentine's Day Shooting Game</h4>
  </div>
  <div id="player"></div>
  <div id="score">Score: 0</div>
  <div id="timer">30.00</div>
  <input type="number" id="timer-input" value="30" min="0" max="999.99" step="0.01">
  <div id="game-over">Game Over</div>
  <div id="hit-message" class="message">
    <img id="hit-image" src="" alt="Hit Image" style="max-width: 200px; display: block; margin: 0 auto;">
    <div id="hit-text">おめでとう</div>
  </div>
  <button id="start-button">Start Game</button>
</div>

  <script>
    // --- 変数定義 ---
    let gameStarted = false;
    let gameOver = false;
    let playerX = 180;
    let playerY = 530;
    let score = 0;
    let timeLeft;
    let timerInterval;
    const bullets = [];
    const enemies = [];
    const messages = [
      "おめでとう", "その調子", "ナイスショット！", "がんばって！",
      "フレーフレー！", "まだまだこれから！", "諦めないで！",
      "ミクも応援してるよ！", "ミクと一緒に頑張ろう！", "ミクも嬉しい！"
    ];
    const hitImages = [
      "./miku-images/miku (1).png", "./miku-images/miku (2).png",
      "./miku-images/miku (3).png", "./miku-images/miku (4).png",
      "./miku-images/miku (5).png", "./miku-images/miku (6).png",
      "./miku-images/miku (7).png"
    ];

    // --- DOM取得 ---
    const gameContainer = document.getElementById('game-container');
    const player = document.getElementById('player');
    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('timer');
    const timerInput = document.getElementById('timer-input');
    const gameOverDisplay = document.getElementById('game-over');
    const hitMessage = document.getElementById('hit-message');
    const hitImage = document.getElementById('hit-image');
    const hitText = document.getElementById('hit-text');
    const startButton = document.getElementById('start-button');

    // --- 音声ファイル ---
    const bulletSound = new Audio('./assets/ショット.mp3');
    const hitSound = new Audio('./assets/ショット命中.mp3');
    const alarmSound = new Audio('./assets/警告音1.mp3');

    // --- 初期位置設定 ---
    player.style.left = playerX + 'px';
    player.style.top = playerY + 'px';

    // --- 弾生成 ---
    function createBullet() {
      const bullet = document.createElement('div');
      bullet.classList.add('bullet');
      bullet.style.left = playerX + 10 + 'px';
      bullet.style.top = playerY - 10 + 'px';
      gameContainer.appendChild(bullet);
      bullets.push(bullet);
      bulletSound.play();
    }

    // --- 弾移動 ---
    function moveBullets() {
      for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        const bulletY = parseInt(bullet.style.top);
        if (bulletY < 0) {
          bullet.remove();
          bullets.splice(i, 1);
        } else {
          bullet.style.top = bulletY - 5 + 'px';
          checkCollision(bullet, i);
        }
      }
    }

    // --- 敵生成 ---
    function createEnemy() {
      const enemy = document.createElement('div');
      enemy.classList.add('enemy');
      enemy.style.left = Math.random() * 370 + 'px';
      enemy.style.top = '50px';
      gameContainer.appendChild(enemy);
      enemies.push(enemy);
    }

    // --- 敵移動 ---
    function moveEnemies() {
      for (let i = enemies.length - 1; i >= 0; i--) {
        const enemy = enemies[i];
        const enemyY = parseInt(enemy.style.top);
        if (enemyY > 600) {
          enemy.remove();
          enemies.splice(i, 1);
        } else {
          enemy.style.top = enemyY + 2 + 'px';
          checkPlayerCollision(enemy);
        }
      }
    }

    // --- 衝突判定（弾と敵） ---
    function checkCollision(bullet, bulletIndex) {
      const bulletRect = bullet.getBoundingClientRect();
      for (let i = enemies.length - 1; i >= 0; i--) {
        const enemy = enemies[i];
        const enemyRect = enemy.getBoundingClientRect();
        if (
          bulletRect.left < enemyRect.right &&
          bulletRect.right > enemyRect.left &&
          bulletRect.top < enemyRect.bottom &&
          bulletRect.bottom > enemyRect.top
        ) {
          bullet.remove();
          bullets.splice(bulletIndex, 1);
          enemy.remove();
          enemies.splice(i, 1);
          score++;
          scoreDisplay.textContent = 'Score: ' + score;
          hitSound.play();
          const randomMessage = messages[Math.floor(Math.random() * messages.length)];
          const randomImage = hitImages[Math.floor(Math.random() * hitImages.length)];
          hitText.textContent = randomMessage;
          hitImage.src = randomImage;
          hitMessage.style.display = 'block';
          setTimeout(() => {
            hitMessage.style.display = 'none';
          }, 1000);
          break;
        }
      }
    }

    // --- 衝突判定（プレイヤーと敵） ---
    function checkPlayerCollision(enemy) {
      if (gameOver) return;
      const playerRect = player.getBoundingClientRect();
      const enemyRect = enemy.getBoundingClientRect();
      if (
        playerRect.left < enemyRect.right &&
        playerRect.right > enemyRect.left &&
        playerRect.top < enemyRect.bottom &&
        playerRect.bottom > enemyRect.top
      ) {
        gameOver = true;
        gameOverDisplay.style.display = 'block';
      }
    }

    // --- キー操作 ---
    document.addEventListener('keydown', (event) => {
      if (gameOver) return;
      if (event.key === ' ') {
        createBullet();
      } else if (event.key === 'ArrowLeft') {
        playerX = Math.max(0, playerX - 10);
        player.style.left = playerX + 'px';
      } else if (event.key === 'ArrowRight') {
        playerX = Math.min(380, playerX + 10);
        player.style.left = playerX + 'px';
      }
    });

    // --- タイマー更新 ---
    function updateTimer() {
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        gameOver = true;
        gameOverDisplay.textContent = 'Time Up! Score: ' + score;
        gameOverDisplay.style.display = 'block';
      } else {
        timeLeft -= 0.01;
        timerDisplay.textContent = timeLeft.toFixed(2);
      }
    }

    // --- ゲーム開始 ---
    startButton.addEventListener('click', () => {
      if (gameStarted) return;
      gameStarted = true;
      alarmSound.play();
      startButton.style.display = 'none';
      timeLeft = parseFloat(timerInput.value);
      if (isNaN(timeLeft) || timeLeft <= 0) timeLeft = 30.00;
      timerDisplay.textContent = timeLeft.toFixed(2);
      timerInterval = setInterval(updateTimer, 10);
      setInterval(() => {
        if (!gameOver) createEnemy();
      }, 1000);
      setInterval(() => {
        if (!gameOver) {
          moveBullets();
          moveEnemies();
        }
      }, 30);
    });
  </script>
</body>
</html>